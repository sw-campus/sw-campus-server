# 06. 설계 원칙

> 실용주의 프로그래머(The Pragmatic Programmer)의 원칙을 기반으로 합니다.

---

## 🎯 핵심 원칙 요약

| 원칙 | 핵심 메시지 |
|------|------------|
| YAGNI | 필요할 때 만들어라 |
| 중복 코드 허용 | 잘못된 추상화보다 중복이 낫다 |
| 예광탄 개발 | 핵심을 먼저 끝까지 관통하라 |
| 깨진 창문 금지 | 나쁜 코드를 방치하지 마라 |
| 우연 금지 | 왜 동작하는지 알고 넘어가라 |
| 테스트 전략 | Domain은 TDD, 나머지는 선택적 |

---

## 1. YAGNI (You Aren't Gonna Need It)

> **"지금 필요하지 않으면 만들지 마라"**

### 원칙

```
❌ "나중에 쓸 것 같아서" 미리 만든 코드
❌ "확장성을 위해" 미리 추가한 추상화
❌ "언젠가 필요할" 인터페이스

✅ 현재 요구사항에 필요한 코드만 작성
✅ 실제로 필요해지면 그때 추가
```

### 적용 예시

| 상황 | ❌ YAGNI 위반 | ✅ 권장 |
|------|--------------|--------|
| Repository | "DB 바꿀 수 있으니" 모든 곳에 인터페이스 | 교체 계획이 있을 때만 인터페이스 |
| 유틸리티 | "여러 곳에서 쓸 것 같으니" 미리 shared에 | 2번 이상 사용될 때 추출 |
| 패턴 적용 | "확장성 위해" 미리 Strategy 패턴 | 실제 변형이 필요할 때 |
| 설정 | "나중에 바꿀 수 있게" 모든 값 설정화 | 실제로 변경이 필요한 값만 |

---

## 2. 중복 코드 허용 (Duplication Policy)

> **"잘못된 추상화보다 중복이 낫다"** - Sandi Metz

### 핵심 원칙

```
레이어 경계의 중복 = 관심사 분리 (허용)
모듈 경계의 중복 = 결합도 감소 (허용)
동일 모듈 내 중복 = 리팩토링 대상 (제거)
```

### 허용하는 중복

#### 1) 레이어 간 DTO 중복

```
api 모듈:      CreateUserRequest (입력 검증 책임)
domain 모듈:   User (비즈니스 규칙 책임)
infra 모듈:    UserEntity (영속성 책임)

→ 각 레이어의 관심사가 다르므로 "중복"이 아님
```

#### 2) 도메인 간 유사 로직

```
User.validate()
Order.validate()

→ 비슷해 보여도 각 도메인 규칙은 독립적으로 변경됨
```

### 3번의 법칙 (Rule of Three)

```
1번째 사용: 그냥 작성한다
2번째 사용: 중복을 인지하되, 일단 복사한다
3번째 사용: 이제 리팩토링한다 (공통화 고려)
```

#### 단, 레이어/모듈 경계는 더 신중하게

```
같은 모듈 내 중복 → 3번이면 추출
다른 모듈 간 중복 → 5번 이상 + 변경 패턴이 동일할 때만 shared로
```

---

## 3. 예광탄 개발 (Tracer Bullets)

> **"어둠 속에서 목표를 맞추려면 예광탄을 쏴라"**

### 개념

```
예광탄 = 실제 코드로 전체 아키텍처를 관통하는 것

기능 하나를 API → Domain → Infra 전체 연결하여
아키텍처가 실제로 동작하는지 검증
```

### 프로토타입과의 차이

| 구분 | 예광탄 | 프로토타입 |
|------|--------|-----------|
| 코드 품질 | 실제 코드 수준 | 버릴 코드 |
| 목적 | 아키텍처 검증 + 점진적 확장 | 기술 검증, 학습 |
| 결과물 | 계속 사용 | 폐기 |

### 적용 방법

```
1. 가장 핵심 유스케이스 하나 선택
   예: Auth → "이메일 로그인"

2. 전체 레이어 관통 구현
   Controller → Service → Repository → Entity

3. 동작 확인 후 나머지 기능 확장
```

---

## 4. 깨진 창문 금지 (No Broken Windows)

> **"나쁜 코드를 방치하면 더 나쁜 코드가 쌓인다"**

### 깨진 창문 예시

```
❌ 주석 처리된 코드 방치
❌ TODO 없는 임시 코드
❌ 테스트 없이 머지된 복잡한 로직
❌ 네이밍 컨벤션 위반
❌ 사용하지 않는 import, 변수
❌ 복붙으로 인한 중복 코드
```

### TODO/FIXME 규칙

```java
// ❌ 기한 없는 TODO
// TODO: 나중에 리팩토링

// ✅ 기한 + 담당자 명시
// TODO(2025-01-15, @username): 성능 개선 필요 - #123 이슈 참고
```

---

## 5. 우연에 맡기는 프로그래밍 금지

> **"왜 동작하는지 모르면서 넘어가지 마라"**

### 위험 신호

```
❌ "일단 돌아가니까 커밋"
❌ "스택오버플로우에서 복붙했는데 됨"
❌ "어? 갑자기 되네?"
❌ "이유는 모르겠지만 이렇게 하면 에러 안 남"
```

### 원칙

```
✅ 왜 동작하는지 설명할 수 있어야 한다
✅ 복붙 코드는 반드시 이해 후 사용
✅ "동작함" ≠ "올바름"
```

---

## 6. 테스트 전략

> **Domain 레이어는 TDD로, 나머지는 필요에 따라**

### 레이어별 테스트 정책

| 레이어 | 테스트 | 수준 | 이유 |
|--------|--------|------|------|
| **Domain** | ✅ 필수 (TDD 권장) | 단위 테스트 | 비즈니스 로직이 핵심 |
| **API** | 🟡 선택적 | 통합 테스트 | 입력 검증, 응답 형식 |
| **Infra** | 🟡 선택적 | 통합 테스트 | 쿼리 정확성 필요 시 |

### 테스트 작성 기준

```
"이 코드가 깨지면 서비스에 심각한 영향을 주는가?"
  → Yes: 테스트 필수
  → No: 선택적
```

---

## 📋 체크리스트

### PR 리뷰 시 확인사항

```markdown
## 설계 원칙 체크리스트

### YAGNI
- [ ] 현재 요구사항에 필요한 코드만 있는가?
- [ ] "나중에 쓸 것 같아서" 추가된 코드는 없는가?

### 중복
- [ ] 레이어/모듈 경계의 중복은 의도적인가?
- [ ] 동일 모듈 내 불필요한 중복은 없는가?

### 깨진 창문
- [ ] 주석 처리된 코드 방치는 없는가?
- [ ] 새 TODO는 기한과 이슈가 있는가?
- [ ] 코드 규칙을 준수했는가?

### 우연 금지
- [ ] 모든 코드를 설명할 수 있는가?
- [ ] 복붙 코드를 이해했는가?

### 테스트
- [ ] Domain 레이어 변경 시 테스트가 있는가?
```
